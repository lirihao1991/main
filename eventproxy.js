!function(t,e){var n="function"==typeof define,r="undefined"!=typeof module&&module.exports;n?define(e):r?module.exports=e(require("debug")("eventproxy")):this[t]=e()}("EventProxy",function(t){t=t||function(){};var e=Array.prototype.slice,n=Array.prototype.concat,r="__all__",i=function(){return this instanceof i?(this._callbacks={},void(this._fired={})):new i};i.prototype.addListener=function(e,n){return t("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push(n),this},i.prototype.bind=i.prototype.addListener,i.prototype.on=i.prototype.addListener,i.prototype.subscribe=i.prototype.addListener,i.prototype.headbind=function(e,n){return t("Add listener for %s",e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].unshift(n),this},i.prototype.removeListener=function(e,n){var r=this._callbacks;if(e)if(n){var i=r[e];if(i)for(var o=i.length,s=0;o>s;s++)n===i[s]&&(t("Remove a listener of %s",e),i[s]=null)}else t("Remove all listeners of %s",e),r[e]=[];else t("Remove all listeners"),this._callbacks={};return this},i.prototype.unbind=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){return this.unbind(t)},i.prototype.bindForAll=function(t){this.bind(r,t)},i.prototype.unbindForAll=function(t){this.unbind(r,t)},i.prototype.trigger=function(n,i){var o,s,a,l,p,u,f=2,c=this._callbacks;for(t("Emit event %s with data %j",n,i);f--;)if(s=f?n:r,o=c[s])for(p=0,u=o.length;u>p;p++)(a=o[p])?(l=f?e.call(arguments,1):arguments,a.apply(this,l)):(o.splice(p,1),p--,u--);return this},i.prototype.emit=i.prototype.trigger,i.prototype.fire=i.prototype.trigger,i.prototype.once=function(t,e){var n=this,r=function(){e.apply(n,arguments),n.unbind(t,r)};return this.bind(t,r),this};var o="undefined"!=typeof process&&process.nextTick||function(t){setTimeout(t,0)};i.prototype.emitLater=function(){var t=this,e=arguments;o(function(){t.trigger.apply(t,e)})},i.prototype.immediate=function(t,e,n){return this.bind(t,e),this.trigger(t,n),this},i.prototype.asap=i.prototype.immediate;var s=function(){var n=this,r=arguments.length,i=0,o={};if(3>r)return this;var s=e.call(arguments,0,-2),a=arguments[r-2],l=arguments[r-1];if("function"!=typeof a)return this;t("Assign listener for events %j, once is %s",s,!!l);for(var p=function(t){var e=l?"once":"bind";n[e](t,function(e){n._fired[t]=n._fired[t]||{},n._fired[t].data=e,o[t]||(o[t]=!0,i++)})},u=s.length,f=0;u>f;f++)p(s[f]);var c=function(e){if(!(u>i)&&o[e]){for(var r=[],p=0;u>p;p++)r.push(n._fired[s[p]].data);l&&n.unbindForAll(c),t("Events %j all emited with data %j",s,r),a.apply(null,r)}};n.bindForAll(c)};return i.prototype.all=function(){var t=n.apply([],arguments);return t.push(!0),s.apply(this,t),this},i.prototype.assign=i.prototype.all,i.prototype.fail=function(t){var e=this;return e.once("error",function(){e.unbind(),t.apply(null,arguments)}),this},i.prototype.tail=function(){var t=n.apply([],arguments);return t.push(!1),s.apply(this,t),this},i.prototype.assignAll=i.prototype.tail,i.prototype.assignAlways=i.prototype.tail,i.prototype.after=function(e,n,r){if(0===n)return r.call(null,[]),this;var i=this,o=[];this._after=this._after||{};var s=e+"_group";this._after[s]={index:0,results:[]},t("After emit %s times, event %s's listenner will execute",n,e);var a=function(l,p){l===e&&(n--,o.push(p),1>n&&(t("Event %s was emit %s, and execute the listenner",e,n),i.unbindForAll(a),r.apply(null,[o]))),l===s&&(n--,i._after[s].results[p.index]=p.result,1>n&&(t("Event %s was emit %s, and execute the listenner",e,n),i.unbindForAll(a),r.call(null,i._after[s].results)))};return i.bindForAll(a),this},i.prototype.group=function(t,n){var r=this,i=t+"_group",o=r._after[i].index;return r._after[i].index++,function(t,s){return t?r.emit.apply(r,["error"].concat(e.call(arguments))):void r.emit(i,{index:o,result:n?n.apply(null,e.call(arguments,1)):s})}},i.prototype.any=function(){var n=this,r=arguments[arguments.length-1],i=e.call(arguments,0,-1),o=i.join("_");t("Add listenner for Any of events %j emit",i),n.once(o,r);for(var s=function(e){n.bind(e,function(r){t("One of events %j emited, execute the listenner"),n.trigger(o,{data:r,eventName:e})})},a=0;a<i.length;a++)s(i[a])},i.prototype.not=function(e,n){var r=this;t("Add listenner for not event %s",e),r.bindForAll(function(r,i){r!==e&&(t("listenner execute of event %s emit, but not event %s.",r,e),n(i))})},i.prototype.done=function(t,n){var r=this;return function(i,o){if(i)return r.emit.apply(r,["error"].concat(e.call(arguments)));var s=e.call(arguments,1);return"string"==typeof t?n?r.emit(t,n.apply(null,s)):r.emit.apply(r,[t].concat(s)):arguments.length<=2?t(o):void t.apply(null,s)}},i.prototype.doneLater=function(t,e){var n=this.done(t,e);return function(){var t=arguments;o(function(){n.apply(null,t)})}},i.create=function(){var t=new i,e=n.apply([],arguments);if(e.length){var r=e[e.length-1],o=e[e.length-2];"function"==typeof r&&"function"==typeof o&&(e.pop(),t.fail(r)),t.assign.apply(t,e)}return t},i.EventProxy=i,i});